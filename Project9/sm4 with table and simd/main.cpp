#include <stdio.h>
#include <stdlib.h>
#include "sm4_simd_sbox.h"
#include<iostream>
#include <sstream>
#include <iomanip>
#include "mytimer.hpp"
using namespace std;
double time233;
int main() {
    unsigned char key[16*8] = { 0x02, 0x21, 0x45, 0x47, 0x89, 0xab, 0xcd, 0xef,
                             0xbe, 0xde, 0xba, 0x08, 0x70, 0x58, 0x11, 0xae };
    unsigned char p[16*8] = { 0x02, 0x21, 0x45, 0x47, 0x89, 0xab, 0xcd, 0xef,
                            0xbe, 0xde, 0xba, 0x08, 0x70, 0x58, 0x11, 0xae,
                            0x01, 0x21, 0x45, 0x47, 0x89, 0xab, 0xcd, 0xef,
                            0xbe, 0xde, 0xba, 0x08, 0x70, 0x58, 0x11, 0xae ,
    0x03, 0x21, 0x45, 0x43, 0x89, 0xab, 0x6d, 0xef,
                            0xb1, 0xde, 0xba, 0x08, 0x70, 0x58, 0x11, 0xae , 
    0xb2, 0x21, 0x46, 0x46, 0x89, 0xa5, 0xcd, 0xef,
                            0xbe, 0xde, 0xba, 0x08, 0x45, 0x47, 0x89, 0xae ,
    0xac, 0xc5, 0x42, 0x47, 0x89, 0xab, 0xcd, 0xef,
                            0xbe, 0xde, 0x6a, 0x08, 0x70, 0x58, 0x11, 0xae , 
    0x89, 0x28, 0x01, 0x67, 0x89, 0xab, 0xcd, 0xef,
                            0xbe, 0xee, 0xba, 0x08, 0x70, 0x58, 0x11, 0xae , 
    0x33, 0x41, 0xc0, 0x45, 0x89, 0xab, 0xcd, 0xef,
                            0xbe, 0xdd, 0xba, 0x08, 0x70, 0x58, 0x11, 0xae , 
    0x12, 0x21, 0x45, 0x57, 0x89, 0xcb, 0xcd, 0xef,
                            0xbe, 0xde, 0xba, 0x08, 0x70, 0x58, 0x11, 0xae , };
    SM4_Key sm4_key;
    int success = SM4_KeyInit(key, &sm4_key);
    if (success) {
        mytimer _time;
        _time.UpDate();
        SM4_Encrypt_x8(p, p, sm4_key);
        double end1 = _time.GetSecond();
        time233 = double(end1);
        printf("C:\n");
        for (int j = 0; j < 8; j++) {
            printf("\t");
            for (int i = 0; i < 16; i++) {
                printf("%02x ", p[i + 16 * j]);
            }
            printf("\n");
        }

        printf("P:\n");
        SM4_Decrypt_x8(p, p, sm4_key);
        for (int j = 0; j < 8; j++) {
            printf("\t");
            for (int i = 0; i < 16; i++) {
                printf("%02x ", p[i + 16 * j]);
            }
            printf("\n");
        }
        SM4_KeyDelete(sm4_key);
    }
    cout << endl << endl << "Time for encryption of SM4 with SIMD and table:  " << fixed << setprecision(7) << time233 << " s" << endl << endl;
    system("pause");
    return 0;
}